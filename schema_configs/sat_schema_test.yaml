version: 2

collision_code: test
target_entity_type: sat
target_schema: auto_dv_integration

models:
  - target: sat_customer
    source: auto_dv_psa.customer
    columns:
      - target: dv_hkey_sat_customer
        data_type: string
        key_type: hash_key_sat
        tests:
          - unique
          - not_null

      - target: dv_hkey_hub_customer
        data_type: string
        key_type: hash_key_hub
        source:
          - cst_no
        tests:
          - not_null
          - orphan:
              parent_table: auto_dv_integration.hub_customer
              parent_column: dv_hkey_hub_customer

      - target: dv_hsh_dif
        data_type: string
        key_type: hash_diff

      - target: cst_nm
        data_type: string
        source:
          - cst_nm

      - target: cst_full_nm
        data_type: string
        source:
          - cst_full_nm

      - target: cst_type
        data_type: string
        source:
          - cst_type

  - target: sat_customer_2
    source: auto_dv_psa.customer
    columns:
      - target: dv_hkey_sat_customer
        data_type: string
        key_type: hash_key_sat
        tests:
          - unique
          - not_null

      - target: dv_hkey_hub_customer
        data_type: string
        key_type: hash_key_hub
        source:
          - cst_no
          - br_cd
        tests:
          - not_null
          - orphan:
              parent_table: auto_dv_integration.hub_customer
              parent_column: dv_hkey_hub_customer

      - target: create_dt
        data_type: timestamp
        key_type: dependent_key
        source:
          - create_dt

      - target: dv_hsh_dif
        data_type: string
        key_type: hash_diff

      - target: cst_nm
        data_type: string
        source:
          - cst_nm

      - target: cst_full_nm
        data_type: string
        source:
          - cst_full_nm

      - target: cst_type
        data_type: string
        source:
          - cst_type